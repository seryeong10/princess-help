<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>세령공주 구출</title>
<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden}
.game{position:fixed;inset:0}
.img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
.hs{position:absolute;border:0;background:transparent}
.hs:active{transform:scale(.95)}

#stream{
 position:absolute;
 left:50%;
 top:10%;
 width:30%;
 transform:translateX(-50%) translateY(-60px);
 opacity:0;
 pointer-events:none;
}

@keyframes drop{
 0%{opacity:0;transform:translateX(-50%) translateY(-60px)}
 10%{opacity:1}
 100%{opacity:0;transform:translateX(-50%) translateY(420px)}
}

#boom{
 position:absolute;
 inset:0;
 width:100%;
 height:100%;
 object-fit:cover;
 opacity:0;
}
</style>
</head>
<body>
<div class="game" id="game">
<img id="scene" class="img">
<img id="stream">
<img id="boom" src="boom.png">
</div>

<!-- 사운드 -->
<audio id="bgm" src="bgm.mp3" loop></audio>
<audio id="endbgm" src="end.mp3" loop></audio>
<audio id="tap" src="tap.mp3"></audio>
<audio id="unlock" src="unlock.mp3"></audio>
<audio id="mix" src="mix.mp3"></audio>
<audio id="pour" src="pour.mp3"></audio>
<audio id="paper" src="paper.mp3"></audio>
<audio id="get" src="get.mp3"></audio>
<audio id="stage" src="stage.mp3"></audio>
<audio id="drawer" src="drawer.mp3"></audio>
<audio id="boomS" src="boom.mp3"></audio>

<script>
const scene=document.getElementById("scene");
const game=document.getElementById("game");
const stream=document.getElementById("stream");
const boom=document.getElementById("boom");

const bgm=document.getElementById("bgm");
const endbgm=document.getElementById("endbgm");
const tap=document.getElementById("tap");
const unlock=document.getElementById("unlock");
const mix=document.getElementById("mix");
const pour=document.getElementById("pour");
const paper=document.getElementById("paper");
const get=document.getElementById("get");
const stage=document.getElementById("stage");
const drawer=document.getElementById("drawer");
const boomS=document.getElementById("boomS");

function s(a){a.currentTime=0;a.play();}
function clearHS(){document.querySelectorAll(".hs").forEach(e=>e.remove())}
function addHS(x,y,w,h,fn){
 const b=document.createElement("button");
 b.className="hs";
 b.style.left=x+"%";
 b.style.top=y+"%";
 b.style.width=w+"%";
 b.style.height=h+"%";
 b.onclick=fn;
 game.appendChild(b);
}
function setScene(src){scene.src=src;clearHS();}

/* 시작 */
function S0(){
 setScene("s0.png");
 addHS(0,0,100,100,()=>{
  s(tap);
  bgm.volume=.35;
  bgm.play();
  S1();
 });
}

function S1(){
 setScene("s1.png");
 addHS(0,0,100,100,()=>{s(tap);F0();});
}

/* 손전등 방 */
function F0(){
 setScene("f0.png");
 addHS(30,55,40,25,()=>{s(drawer);F1();});
}

function F1(){
 setScene("k2c.png");
 addHS(35,60,30,20,()=>{s(get);F2();});
}

function F2(){
 setScene("k3c.png");
 setTimeout(()=>Wall(),1000);
}

function Wall(){
 setScene("fl.png");
 addHS(5,85,25,10,()=>{s(tap);setScene("fl.png");WallBtns(false);});
 addHS(37,85,25,10,()=>{s(tap);setScene("fc.png");WallBtns(true);});
 addHS(70,85,25,10,()=>{s(tap);setScene("fr.png");WallBtns(false);});
}

function WallBtns(found){
 addHS(5,85,25,10,()=>{setScene("fl.png");WallBtns(found);});
 addHS(37,85,25,10,()=>{setScene("fc.png");WallBtns(true);});
 addHS(70,85,25,10,()=>{setScene("fr.png");WallBtns(found);});
 if(found){
  addHS(30,95,40,5,()=>{s(unlock);Lock1();});
 }
}

/* 자물쇠 1 (1019) */
function Lock1(){
 setScene("k1c.png");
 mountLock("1019","k1o.png",Potion);
}

/* 자물쇠 2 (0506) */
function Lock2(){
 setScene("k1c.png");
 mountLock("0506","k1o.png",Books);
}

/* 숫자 로직 */
function mountLock(answer,openImg,next){
 let code=["0","0","0","0"];
 const baseX=31, baseY=44, w=38, h=15;
 for(let i=0;i<4;i++){
  addHS(baseX+i*(w/4),baseY,w/4,h,()=>{
   s(tap);
   code[i]=(Number(code[i])+1)%10+"";
   if(code.join("")===answer){
    s(unlock);
    scene.src=openImg;
    setTimeout(()=>{s(stage);next();},700);
   }
  });
 }
}

/* 물약 */
let picked=[];
const potionMap={
 "blue":"q1.png",
 "brown":"q2.png",
 "black":"q3.png",
 "purple":"q4.png",
 "skin":"q5.png",
 "red":"q6.png",
 "pink":"q7.png",
 "lime":"q8.png",
 "yellow":"q9.png"
};

function Potion(){
 picked=[];
 setScene("p0.png");

 addHS(10,60,12,15,()=>drop("blue"));
 addHS(25,60,12,15,()=>drop("brown"));
 addHS(40,60,12,15,()=>drop("black"));
 addHS(55,60,12,15,()=>drop("purple"));
 addHS(70,60,12,15,()=>drop("red"));
 addHS(10,75,12,15,()=>drop("pink"));
 addHS(25,75,12,15,()=>drop("lime"));
 addHS(40,75,12,15,()=>drop("yellow"));

 addHS(75,10,20,10,()=>{
  s(paper);
  setScene("m0.png");
  addHS(0,0,100,100,()=>Potion());
 });

 addHS(10,90,20,8,()=>{
  s(paper);
  setScene("pp0.png");
  addHS(70,85,25,10,()=>{
   s(pour);
   if(picked.sort().join()==="black,brown,blue"){
    s(stage);
    setScene("pp1.png");
    addHS(0,0,100,100,()=>Lock2());
   }else{
    s(boomS);
    boom.style.opacity=1;
    setTimeout(()=>{boom.style.opacity=0;Potion();},800);
   }
  });
 });
}

function drop(color){
 s(mix);
 picked.push(color);
 stream.src="img/"+potionMap[color];
 stream.style.animation="none";
 void stream.offsetWidth;
 stream.style.animation="drop 600ms ease forwards";
}

/* 책장 */
function Books(){
 setScene("b0.png");

 addHS(10,60,30,10,()=>{s(tap);});
 addHS(10,72,30,10,()=>{s(tap);});

 addHS(10,84,30,10,()=>{
  s(get);
  setScene("key.png");
  addHS(0,0,100,100,()=>Lock3());
 });
}

/* 마지막 자물쇠 */
function Lock3(){
 setScene("k3c.png");
 addHS(0,0,100,100,()=>{
  s(unlock);
  setScene("k3o.png");
  setTimeout(()=>End(),800);
 });
}

/* 엔딩 */
function End(){
 bgm.pause();
 endbgm.play();
 setScene("end.png");
}

S0();
</script>
</body>
</html>
