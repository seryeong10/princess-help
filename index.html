<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<title>ì„¸ë ¹ê³µì£¼ êµ¬ì¶œ</title>
<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden}
.game{position:fixed;inset:0}

/* ë°°ê²½ ì´ë¯¸ì§€ */
.img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}

/* ê³µìš© í•«ìŠ¤íŒŸ */
.hs{position:absolute;border:0;background:transparent;-webkit-tap-highlight-color:transparent}
.hs:active{transform:scale(.98)}

/* ìƒë‹¨ ì•ˆë‚´ í…ìŠ¤íŠ¸ */
.hintText{
  position:absolute;top:14px;left:0;right:0;
  text-align:center;color:#fff;font-weight:900;
  text-shadow:0 2px 10px rgba(0,0,0,.85);
  padding:0 14px;z-index:9999;pointer-events:none;
  font-size:18px;
}

/* ë²½ ì´ë™ UI */
.uiBar{
  position:absolute;left:0;right:0;bottom:18px;
  display:none;justify-content:center;gap:12px;z-index:9999
}
.uiBtn{
  border:0;border-radius:50%;
  width:64px;height:64px;
  font-size:28px;font-weight:900;
  background:rgba(255,255,255,.92);
  color:#000;
  box-shadow:0 6px 20px rgba(0,0,0,.55);
}
.uiBtn:active{transform:scale(.97)}

/* ë‹¤ìŒ ë²„íŠ¼(íŒíŠ¸ ë³¸ ë’¤ í™œì„±) */
.uiNext{
  position:absolute;right:16px;bottom:98px;
  border:0;border-radius:14px;
  padding:12px 16px;
  font-weight:900;font-size:16px;
  background:#ff4d6d;color:#fff;
  display:none; z-index:9999;
}
.uiNext.show{display:block}

/* ìë¬¼ì‡  ìˆ«ì ë²„íŠ¼ */
:root{
  --lock-x: 22%;
  --lock-y: 50%;
  --lock-w: 56%;
  --lock-h: 9%;
}
.lockDigits{
  position:absolute;
  left:var(--lock-x);
  top:var(--lock-y);
  width:var(--lock-w);
  height:var(--lock-h);
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:4%;
  z-index:9999;
}
.digitBtn{
  border:0;border-radius:14px;
  background:rgba(0,0,0,.40);
  color:#fff;
  font-weight:900;
  font-size:clamp(18px, 6vw, 34px);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.14), 0 8px 18px rgba(0,0,0,.35);
  -webkit-tap-highlight-color:transparent;
}
.digitBtn:active{ transform:scale(.97); }

/* ì„±ê³µ/ì‹¤íŒ¨ ì´í™íŠ¸ */
.lockSuccess{ animation: glowGreen 0.6s ease; }
@keyframes glowGreen{
  0%{ box-shadow:0 0 0px #00ff88; }
  50%{ box-shadow:0 0 28px #00ff88; }
  100%{ box-shadow:0 0 0px #00ff88; }
}
.lockFail{ animation: glowRed 0.4s ease; }
@keyframes glowRed{
  0%{ box-shadow:0 0 0px #ff0000; }
  50%{ box-shadow:0 0 28px #ff0000; }
  100%{ box-shadow:0 0 0px #ff0000; }
}
.shake{ animation: shakeLock .35s ease; }
@keyframes shakeLock{
  0%{transform:translateX(0)}
  25%{transform:translateX(-6px)}
  50%{transform:translateX(6px)}
  75%{transform:translateX(-4px)}
  100%{transform:translateX(0)}
}

/* 2ë‹¨ê³„: ë³‘/ë²„íŠ¼/ì¢…ì´ */
.layer{position:absolute;inset:0;z-index:5000}
.jarRow{position:absolute;left:0;right:0;bottom:8%;display:flex;justify-content:center;gap:18px;z-index:6000}
.jarRow2{position:absolute;left:0;right:0;bottom:1%;display:flex;justify-content:center;gap:18px;z-index:6000}
.jarImg{width:86px;height:auto;filter:drop-shadow(0 10px 14px rgba(0,0,0,.35));}

.potionBtn{
  position:absolute;left:50%;bottom:16px;transform:translateX(-50%);
  border:0;border-radius:14px;
  padding:14px 18px;
  font-weight:900;font-size:18px;
  background:#27d17b;color:#06150c;
  box-shadow:0 10px 22px rgba(0,0,0,.35);
  display:none;z-index:7000;
}
.potionBtn.show{display:block}
.lockBtn2{
  position:absolute;left:50%;bottom:86px;transform:translateX(-50%);
  border:0;border-radius:14px;
  padding:12px 18px;
  font-weight:900;font-size:17px;
  background:#ffffff;color:#000;
  box-shadow:0 10px 22px rgba(0,0,0,.35);
  display:none;z-index:7000;
}
.lockBtn2.show{display:block}

.retryBtn{
  position:absolute;left:50%;top:62%;transform:translateX(-50%);
  border:0;border-radius:14px;
  padding:14px 20px;
  font-weight:900;font-size:18px;
  background:#fff;color:#000;
  box-shadow:0 10px 22px rgba(0,0,0,.45);
  display:none;z-index:8000;
}
.retryBtn.show{display:block}

.paperImg{
  position:absolute;left:50%;top:8%;
  transform:translateX(-50%);
  width:min(78vw,520px);
  height:auto;z-index:7500;
  filter:drop-shadow(0 16px 22px rgba(0,0,0,.35));
}

/* 3ë‹¨ê³„ ì±…(íˆ¬ëª… png) */
.booksWrap{position:absolute;inset:0;z-index:6500;pointer-events:auto}
.bookImg{
  position:absolute;
  width:22vw;max-width:190px;min-width:120px;
  height:auto;
  filter:drop-shadow(0 12px 14px rgba(0,0,0,.3));
}
</style>
</head>
<body>

<div class="game" id="game">
  <img id="scene" class="img" alt="scene">
  <div class="hintText" id="hint"></div>

  <div class="uiBar" id="wallUI">
    <button class="uiBtn" id="btnL">â—€</button>
    <button class="uiBtn" id="btnC">â–²</button>
    <button class="uiBtn" id="btnR">â–¶</button>
  </div>
  <button class="uiNext" id="btnNext">ë‹¤ìŒ â–¶</button>
</div>

<!-- ì‚¬ìš´ë“œ(íŒŒì¼ëª…ì€ ë„¤ í”„ë¡œì íŠ¸ì— ë§ì¶° ë‘ ) -->
<audio id="bgm" src="bgm.mp3" loop></audio>
<audio id="endbgm" src="end.mp3" loop></audio>
<audio id="rrbgm" src="rr.mp3" loop></audio>
<audio id="tap" src="tap.mp3"></audio>
<audio id="unlock" src="unlock.mp3"></audio>
<audio id="mix" src="mix.mp3"></audio>
<audio id="pour" src="pour.mp3"></audio>
<audio id="paper" src="paper.mp3"></audio>
<audio id="get" src="get.mp3"></audio>
<audio id="stage" src="stage.mp3"></audio>
<audio id="drawer" src="drawer.mp3"></audio>
<audio id="boomS" src="boom.mp3"></audio>

<script>
/* =======================
   ê³µìš© ì—˜ë¦¬ë¨¼íŠ¸
======================= */
const scene=document.getElementById("scene");
const game=document.getElementById("game");
const hint=document.getElementById("hint");

const wallUI=document.getElementById("wallUI");
const btnL=document.getElementById("btnL");
const btnC=document.getElementById("btnC");
const btnR=document.getElementById("btnR");
const btnNext=document.getElementById("btnNext");

const bgm=document.getElementById("bgm");
const endbgm=document.getElementById("endbgm");
const rrbgm=document.getElementById("rrbgm");

const tap=document.getElementById("tap");
const unlock=document.getElementById("unlock");
const mix=document.getElementById("mix");
const pour=document.getElementById("pour");
const paper=document.getElementById("paper");
const get=document.getElementById("get");
const stage=document.getElementById("stage");
const drawer=document.getElementById("drawer");
const boomS=document.getElementById("boomS");

function s(a){ try{a.currentTime=0;a.play();}catch{} }

/* =======================
   âœ… "ê²¹ì¹¨" ì™„ì „ ì œê±° í•µì‹¬
   - ëª¨ë“  í•«ìŠ¤íŒŸ/ì˜¤ë²„ë ˆì´/ë ˆì´ì–´ ì œê±°
======================= */
function clearOverlays(){
  document.querySelectorAll(".hs").forEach(el=>el.remove());
  document.querySelectorAll(".lockDigits").forEach(el=>el.remove());
  document.querySelectorAll(".layer").forEach(el=>el.remove());
  document.querySelectorAll(".booksWrap").forEach(el=>el.remove());
  document.querySelectorAll(".paperImg").forEach(el=>el.remove());
  document.querySelectorAll(".potionBtn").forEach(el=>el.remove());
  document.querySelectorAll(".lockBtn2").forEach(el=>el.remove());
  document.querySelectorAll(".retryBtn").forEach(el=>el.remove());
}

/* ì”¬ ì „í™˜(ê²¹ì¹¨ ë°©ì§€) */
function setScene(src){
  scene.src=src;
  hint.textContent="";
  wallUI.style.display="none";
  btnNext.classList.remove("show");
  clearOverlays();
}

/* ì „ì²´ í™”ë©´ íƒ­ */
function fullTap(nextFn){
  const b=document.createElement("button");
  b.className="hs";
  b.style.left="0"; b.style.top="0"; b.style.width="100%"; b.style.height="100%";
  b.onclick=()=>{ b.remove(); nextFn(); };
  game.appendChild(b);
}

/* í•«ìŠ¤íŒŸ */
function addHS(x,y,w,h,fn){
  const b=document.createElement("button");
  b.className="hs";
  b.style.left=x+"%"; b.style.top=y+"%";
  b.style.width=w+"%"; b.style.height=h+"%";
  b.onclick=fn;
  game.appendChild(b);
}

/* =======================
   0) ì‹œì‘/ìŠ¤í† ë¦¬
======================= */
function S0(){
  setScene("s0.png");
  fullTap(()=>{
    s(tap);
    bgm.volume=.35;
    bgm.play().catch(()=>{});
    S1();
  });
}
function S1(){
  setScene("s1.png");
  fullTap(()=>{ s(tap); F0(); });
}

/* =======================
   1) ì†ì „ë“± ë‹¨ê³„
======================= */
function F0(){
  setScene("f0.png");
  hint.textContent="ì±…ìƒì„ ëˆŒëŸ¬ë¼";
  fullTap(()=>{ s(drawer); F1(); });
}
function F1(){
  setScene("k2c.png");
  hint.textContent="ì„œëì„ í™•ì¸í•´ë¼";
  fullTap(()=>{ s(get); F2(); });
}
function F2(){
  setScene("flash.png");
  hint.textContent="ì†ì „ë“± íšë“!";
  setTimeout(()=>WallStart(),1000);
}

/* =======================
   1-1) ë²½(ì™¼/ì •/ì˜¤)
======================= */
let sawHintWall=false;
function WallStart(){
  sawHintWall=false;
  showWall("c");
}
function showWall(where){
  if(where==="l"){ setScene("fl.png"); sawHintWall=true; }
  if(where==="c"){ setScene("fc.png"); }
  if(where==="r"){ setScene("fr.png"); }

  wallUI.style.display="flex";
  btnL.style.display="inline-block";
  btnC.style.display="inline-block";
  btnR.style.display="inline-block";

  hint.textContent = sawHintWall ? "íŒíŠ¸ë¥¼ ì°¾ì•˜ë‹¤!" : "ì–´ë””ì— íŒíŠ¸ê°€ ìˆì„ê¹Œâ€¦?";

  btnL.onclick=()=>{ s(tap); showWall("l"); };
  btnC.onclick=()=>{ s(tap); showWall("c"); };
  btnR.onclick=()=>{ s(tap); showWall("r"); };

  if(sawHintWall) btnNext.classList.add("show");
  else btnNext.classList.remove("show");

  btnNext.onclick=()=>{
    if(!sawHintWall) return;
    s(tap);
    Lock1();
  };
}

/* =======================
   ê³µìš©: ìë¬¼ì‡ 
   - ì„±ê³µ ì‹œ ì—´ë¦° ì´ë¯¸ì§€ë¡œ ë°”ê¾¸ê³ 
   - "í™”ë©´ í„°ì¹˜"í•´ì•¼ ë‹¤ìŒ ë‹¨ê³„ë¡œ
======================= */
function lockStage(answer, closedImg, openImg, nextFn){
  setScene(closedImg);
  hint.textContent="ìˆ«ìë¥¼ ëˆŒëŸ¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë§ì¶°ë¼";

  const wrap=document.createElement("div");
  wrap.className="lockDigits";

  const code=[0,0,0,0];
  const btns=[];

  function flash(cls, ms){
    btns.forEach(b=>{
      b.classList.add(cls);
      setTimeout(()=>b.classList.remove(cls), ms);
    });
  }

  for(let i=0;i<4;i++){
    const b=document.createElement("button");
    b.className="digitBtn";
    b.textContent="0";

    b.addEventListener("pointerdown",(e)=>{
      e.preventDefault();
      s(tap);

      code[i]=(code[i]+1)%10;
      b.textContent=String(code[i]);

      const str=code.join("");
      if(str===answer){
        btns.forEach(x=>x.disabled=true);
        flash("lockSuccess", 600);
        s(unlock);

        setTimeout(()=>{
          // ì—´ë¦° ìë¬¼ì‡  ì´ë¯¸ì§€ë¡œ ë³€ê²½(ìˆ«ìëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€)
          scene.src=openImg;
          hint.textContent="ì—´ë ¸ë‹¤! í™”ë©´ì„ í„°ì¹˜í•´ ë‹¤ìŒìœ¼ë¡œ";
          s(stage);

          // âœ… ìë™ ì§„í–‰ X : í„°ì¹˜í•´ì•¼ ë‹¤ìŒ
          fullTap(()=>{ s(tap); nextFn(); });

        }, 450);
      }else{
        flash("lockFail", 400);
        scene.classList.add("shake");
        setTimeout(()=>scene.classList.remove("shake"),250);
      }
    }, {passive:false});

    wrap.appendChild(b);
    btns.push(b);
  }
  game.appendChild(wrap);
}

function Lock1(){ lockStage("1019","k1c.png","k1o.png",PotionRoom); }
function Lock2(){ lockStage("0506","k1c.png","k1o.png",BookRoom); }

/* =======================
   2) ë¬¼ì•½ë°© (ìƒˆ ì´ë¯¸ì§€ ì„¸íŠ¸)
   bg_potion_room.png
   jar_*.png, manual_popup.png
   paper_clean.png, paper_revealed.png
   - í‹€ë¦¬ë©´: í­íƒ„ì´ë¯¸ì§€ X / í­íƒ„ì†Œë¦¬ + ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ë§Œ
   - ì„±ê³µ: ë¬¼ì•½ë¶“ê¸° ë²„íŠ¼ -> ì¢…ì´(ê¹¨ë—) -> ì¢…ì´ í´ë¦­(ë²ˆì§) + ìë¬¼ì‡  ë²„íŠ¼
======================= */
function PotionRoom(){
  setScene("bg_potion_room.png");
  hint.textContent="ì±…ì„ ëˆŒëŸ¬ ì„¤ëª…ì„œë¥¼ í™•ì¸í•˜ê³ , ë¬¼ì•½ 3ê°œë¥¼ ê³¨ë¼ë¼";

  const layer=document.createElement("div");
  layer.className="layer";
  game.appendChild(layer);

  let picked=[];
  let manualOpen=false;

  // âœ… ì„¤ëª…ì„œ(ì¢Œìƒë‹¨ ì±… ì´ëª¨ì§€ ì˜ì—­) : ì¢Œìƒë‹¨ 0~12% ì •ë„
  addHS(2, 2, 14, 12, ()=>{
    s(paper);
    if(manualOpen){
      // ë‹«ê¸°
      manualOpen=false;
      layer.querySelectorAll(".paperImg").forEach(el=>el.remove());
      hint.textContent="ë¬¼ì•½ 3ê°œë¥¼ ê³¨ë¼ë¼";
    }else{
      // ì—´ê¸°
      manualOpen=true;
      hint.textContent="ì„¤ëª…ì„œë¥¼ í™•ì¸í•´ë¼ (í„°ì¹˜í•˜ë©´ ë‹«í˜)";
      const m=document.createElement("img");
      m.src="manual_popup.png";
      m.className="paperImg";
      m.style.top="8%";
      layer.appendChild(m);
      // í™”ë©´ í„°ì¹˜í•˜ë©´ ë‹«í˜
      m.onclick=()=>{ s(paper); manualOpen=false; m.remove(); hint.textContent="ë¬¼ì•½ 3ê°œë¥¼ ê³¨ë¼ë¼"; };
    }
  });

  // ë³‘ UI ì»¨í…Œì´ë„ˆ
  const row1=document.createElement("div");
  row1.className="jarRow";
  layer.appendChild(row1);

  const row2=document.createElement("div");
  row2.className="jarRow2";
  layer.appendChild(row2);

  const jars=[
    {key:"blue",  src:"jar_blue.png",  row:1},
    {key:"brown", src:"jar_brown.png", row:1},
    {key:"black", src:"jar_black.png", row:1},
    {key:"red",   src:"jar_red.png",   row:1},
    {key:"yellow",src:"jar_yellow.png",row:2},
    {key:"pink",  src:"jar_pink.png",  row:2},
  ];

  function playPour2s(){
    try{
      pour.currentTime=0;
      pour.play();
      setTimeout(()=>{ try{pour.pause(); pour.currentTime=0;}catch{} }, 2000);
    }catch{}
  }

  jars.forEach(j=>{
    const img=document.createElement("img");
    img.src=j.src;
    img.className="jarImg";
    (j.row===1?row1:row2).appendChild(img);

    img.onclick=()=>{
      if(picked.length>=3) return;
      s(mix);
      playPour2s();
      picked.push(j.key);

      // 3ê°œ ëª¨ì´ë©´ íŒì •
      if(picked.length===3){
        setTimeout(checkPotion, 250);
      }
    };
  });

  // ë²„íŠ¼ë“¤
  const pourBtn=document.createElement("button");
  pourBtn.className="potionBtn";
  pourBtn.textContent="ë¬¼ì•½ ë¶“ê¸°";
  layer.appendChild(pourBtn);

  const lockBtn=document.createElement("button");
  lockBtn.className="lockBtn2";
  lockBtn.textContent="ìë¬¼ì‡ ";
  layer.appendChild(lockBtn);

  const retryBtn=document.createElement("button");
  retryBtn.className="retryBtn";
  retryBtn.textContent="ë‹¤ì‹œí•˜ê¸°";
  layer.appendChild(retryBtn);

  function resetPotion(){
    picked=[];
    pourBtn.classList.remove("show");
    lockBtn.classList.remove("show");
    retryBtn.classList.remove("show");
    layer.querySelectorAll(".paperImg").forEach(el=>el.remove());
    hint.textContent="ë¬¼ì•½ 3ê°œë¥¼ ê³¨ë¼ë¼";
  }

  function checkPotion(){
    const need=["blue","brown","black"];
    const ok = need.every(c=>picked.includes(c));

    if(!ok){
      // âœ… í­íƒ„ì´ë¯¸ì§€ ì—†ìŒ: ì†Œë¦¬ + ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ë§Œ
      s(boomS);
      hint.textContent="í‹€ë ¸ë‹¤! ë‹¤ì‹œí•˜ê¸°ë¥¼ ëˆŒëŸ¬ë¼";
      retryBtn.classList.add("show");
      retryBtn.onclick=()=>{ s(tap); resetPotion(); };
      return;
    }

    // ì„±ê³µ
    s(stage);
    hint.textContent="ì •ë‹µ! ë¬¼ì•½ ë¶“ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ë¼";
    pourBtn.classList.add("show");

    // âœ… í•˜ë‹¨ ìœ„ì¹˜(ì¢€ ë” ì•„ë˜ë¡œ) ì´ë¯¸ bottom:16px
    pourBtn.onclick=()=>{
      s(paper);
      showCleanPaper();
    };
  }

  function showCleanPaper(){
    // í™”ë©´ ì •ë¦¬: ì¢…ì´ë§Œ ì¤‘ì•™ì—
    layer.querySelectorAll(".paperImg").forEach(el=>el.remove());
    lockBtn.classList.remove("show"); // ê²¹ì¹¨ ë°©ì§€
    retryBtn.classList.remove("show");

    const p=document.createElement("img");
    p.src="paper_clean.png";
    p.className="paperImg";
    layer.appendChild(p);

    hint.textContent="ì¢…ì´ë¥¼ í´ë¦­í•´ë¼";

    p.onclick=()=>{
      // ì¢…ì´ í´ë¦­ -> ë²ˆì§„ ì¢…ì´ + ìë¬¼ì‡  ë²„íŠ¼
      playPour2s();
      setTimeout(()=>showRevealedPaper(), 250);
    };
  }

  function showRevealedPaper(){
    layer.querySelectorAll(".paperImg").forEach(el=>el.remove());

    const p=document.createElement("img");
    p.src="paper_revealed.png";
    p.className="paperImg";
    layer.appendChild(p);

    hint.textContent="íŒíŠ¸ë¥¼ í™•ì¸í•˜ê³  ìë¬¼ì‡ ë¥¼ ëˆŒëŸ¬ë¼";
    // âœ… ìë¬¼ì‡  ë²„íŠ¼ì€ ë¬¼ì•½ë¶“ê¸° ë²„íŠ¼ ìœ„ì— ê²¹ì¹˜ì§€ ì•Šê²Œ bottom:86px
    lockBtn.classList.add("show");
    lockBtn.onclick=()=>{ s(tap); Lock2(); };
  }

  // ì²« ì§„ì…
  resetPotion();
}

/* =======================
   3) ì±…ì¥ ë‹¨ê³„ (ìƒˆ ì´ë¯¸ì§€ ì„¸íŠ¸)
   b0.png + ì±… 4ê¶Œ(íˆ¬ëª…)
   - ìê¸°ê²°ì •(ì •ë‹µ) ëˆ„ë¥´ë©´ key.png
======================= */
function BookRoom(){
  setScene("b0.png");
  hint.textContent="ì„¸ë ¹ê³µì£¼ì—ê²Œ ì¤€ ì±…ì„ ì°¾ì•„ë¼";

  const wrap=document.createElement("div");
  wrap.className="booksWrap";
  game.appendChild(wrap);

  // ë°°ê²½ ì±…ì¥ ì¤‘ì•™ì— ë§ì¶° "ì¢€ ì‘ê²Œ" + ì•„ë˜ë¡œ ë°€ë¦¼ ë°©ì§€
  // (í•„ìš”í•˜ë©´ ì—¬ê¸° ìˆ«ìë§Œ ì‚´ì§ ì¡°ì •í•˜ë©´ ë¨)
  const books=[
    {src:"book1.png",   label:"ë…¸ì¸ê³¼ ë°”ë‹¤",  ok:false, x:40, y:28},
    {src:"book2.png",label:"ë„ˆì˜ ê²°ì •",    ok:false, x:40, y:45},
    {src:"book3.png",    label:"ê¸‰ ë¥˜",         ok:false, x:40, y:62},
    {src:"book4.png",     label:"ìê¸° ê²°ì •",     ok:true,  x:40, y:79},
  ];

  // ğŸ“Œ ë„¤ íŒŒì¼ëª…ì´ ìœ„ì™€ ë‹¤ë¥´ë©´ ì—¬ê¸° srcë§Œ ë„¤ íŒŒì¼ëª…ìœ¼ë¡œ ë°”ê¿”ì¤˜!
  // ì˜ˆ) "ë…¸ì¸ê³¼ ë°”ë‹¤.png" ì´ëŸ° ì‹ì´ë©´ srcë¥¼ ê·¸ê±¸ë¡œ.

  books.forEach(b=>{
    const img=document.createElement("img");
    img.src=b.src;
    img.className="bookImg";
    // ì¤‘ì•™ì— "ìŒ“ì¸ ëŠë‚Œ"ìœ¼ë¡œ
    img.style.left=b.x+"%";
    img.style.top=b.y+"%";
    img.style.transform="translateX(-50%)";
    wrap.appendChild(img);

    img.onclick=()=>{
      s(tap);
      if(!b.ok){
        hint.textContent="ë•¡!";
        setTimeout(()=>hint.textContent="ì„¸ë ¹ê³µì£¼ì—ê²Œ ì¤€ ì±…ì„ ì°¾ì•„ë¼",700);
      }else{
        s(get);
        showKey();
      }
    };
  });

  function showKey(){
    setScene("key.png");
    hint.textContent="ì—´ì‡  íšë“! í™”ë©´ì„ í„°ì¹˜í•´ ìë¬¼ì‡ ë¡œ";
    fullTap(()=>{ s(tap); Lock3(); });
  }
}

/* =======================
   3-1) ë§ˆì§€ë§‰ ìë¬¼ì‡ 
   k3c -> í„°ì¹˜ -> k3o -> í„°ì¹˜ -> ì—”ë”©
======================= */
function Lock3(){
  setScene("k3c.png");
  hint.textContent="í™”ë©´ì„ í„°ì¹˜í•´ ìë¬¼ì‡ ë¥¼ ì—´ì–´ë¼";
  fullTap(()=>{
    s(unlock);
    setScene("k3o.png");
    hint.textContent="ì—´ë ¸ë‹¤! í™”ë©´ì„ í„°ì¹˜í•´ êµ¬ì¶œí•˜ëŸ¬ ê°€ê¸°";
    fullTap(()=>{
      s(tap);
      End();
    });
  });
}

/* =======================
   ì—”ë”© + í¸ì§€
   - ì—”ë”© í™”ë©´ í„°ì¹˜ X
   - 1ì´ˆ ë’¤ í¸ì§€ ë²„íŠ¼ ìƒì„±
   - í¸ì§€ ë²„íŠ¼ ëˆ„ë¥´ë©´ end.mp3 ë„ê³  rr.mp3 ì¼œê¸°
======================= */
function End(){
  bgm.pause(); bgm.currentTime=0;
  rrbgm.pause(); rrbgm.currentTime=0;

  endbgm.volume=0.55;
  endbgm.play().catch(()=>{});

  setScene("end.png");
  hint.textContent="êµ¬ì¶œ ì„±ê³µ!";

  // 1ì´ˆ ë’¤ ë²„íŠ¼ ìƒì„±
  setTimeout(()=>{
    const btn=document.createElement("button");
    btn.className="hs";
    btn.style.left="50%";
    btn.style.top="82%";
    btn.style.transform="translateX(-50%)";
    btn.style.width="220px";
    btn.style.height="56px";
    btn.style.borderRadius="14px";
    btn.style.background="rgba(255,255,255,.92)";
    btn.style.fontWeight="900";
    btn.style.fontSize="18px";
    btn.style.boxShadow="0 10px 22px rgba(0,0,0,.45)";
    btn.textContent="í¸ì§€ ë³´ëŸ¬ê°€ê¸°";
    btn.onclick=()=>{
      s(tap);
      endbgm.pause(); endbgm.currentTime=0;
      rrbgm.volume=0.6;
      rrbgm.play().catch(()=>{});
      showLetter();
    };
    game.appendChild(btn);
  }, 1000);
}

function showLetter(){
  setScene("letter.png");
  hint.textContent="";
}

/* =======================
   ì‹œì‘
======================= */
S0();
</script>

</body>
</html>
